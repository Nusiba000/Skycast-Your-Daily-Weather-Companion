<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SkyCast Your Daily Weather Companion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    input, select {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      min-width: 120px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #4A90E2;
      color: white;
      cursor: pointer;
    }
    .weather-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    .left {
      flex: 1;
      min-width: 200px;
    }
    .right img {
      width: 100px;
    }
    .big {
      font-size: 2.5em;
      font-weight: bold;
    }
    .sub {
      color: #666;
      font-size: 0.9em;
      margin-top: 5px;
    }
    .tile {
      background: #f0f0f0;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
    }
    .day {
      font-weight: bold;
      margin-bottom: 5px;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.8em;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SkyCast Your Daily Weather Companion</h1>
    <form id="searchForm">
      <input type="text" id="cityInput" placeholder="Enter city name" />
      <select id="units">
        <option value="metric">°C</option>
        <option value="imperial">°F</option>
      </select>
      <button type="submit">Search</button>
    </form>

    <div id="current" class="weather-section"></div>
    <div id="forecast"></div>

    <footer>
      &copy; <span id="footerYear"></span> Weather App
    </footer>
  </div>

  <script>
  const BASE = 'http://localhost:4000/api'; // your backend

  const form = document.getElementById('searchForm');
  const input = document.getElementById('cityInput');
  const unitsSel = document.getElementById('units');
  const currentEl = document.getElementById('current');
  const forecastEl = document.getElementById('forecast');
  const footerYear = document.getElementById('footerYear');
  footerYear.textContent = new Date().getFullYear();

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const city = input.value.trim();
    if(!city) return;
    const units = unitsSel.value;
    try{
      setLoading(true);

      // ✅ call your backend (no API key in the browser!)
      const url = `${BASE}/weather?city=${encodeURIComponent(city)}&units=${encodeURIComponent(units)}`;
      const res = await fetch(url);
      const data = await res.json();
      if (!res.ok || !data.ok) {
        throw new Error((data && data.error) || `Request failed (${res.status})`);
      }

      renderCurrent(data.current, units);
      renderForecast(data.forecast, units);
    }catch(err){
      renderError(err);
    }finally{
      setLoading(false);
    }
  });

  function setLoading(isLoading){
    if(isLoading){
      currentEl.innerHTML = `<div class="sub">Loading...</div>`;
      forecastEl.innerHTML = '';
    }
  }

  function renderCurrent(data, units){
    const temp = Math.round(data.main.temp);
    const desc = data.weather?.[0]?.description || '—';
    const icon = data.weather?.[0]?.icon || '01d';
    const city = `${data.name}, ${data.sys?.country || ''}`;
    const feels = Math.round(data.main.feels_like);
    const wind = Math.round(data.wind.speed);

    const unitSym = units === 'metric' ? '°C' : '°F';
    const windUnit = units === 'metric' ? 'm/s' : 'mph';

    currentEl.innerHTML = `
      <div class="left">
        <div class="big">${temp}${unitSym}</div>
        <div>${capitalize(desc)}</div>
        <div class="sub">Feels like ${feels}${unitSym} • Wind ${wind} ${windUnit}</div>
        <div class="sub">${city}</div>
      </div>
      <div class="right">
        <img alt="icon" src="https://openweathermap.org/img/wn/${icon}@2x.png" />
      </div>
    `;
  }

  function renderForecast(data, units){
    const byDay = {};
    for(const item of data.list){
      const dt = new Date(item.dt * 1000);
      const dayKey = dt.toISOString().slice(0,10);
      const hour = dt.getHours();
      if(!byDay[dayKey]) byDay[dayKey] = [];
      byDay[dayKey].push({hour, item});
    }

    const todayKey = new Date().toISOString().slice(0,10);
    const nextDays = Object.keys(byDay)
      .filter(k => k !== todayKey)
      .sort()
      .slice(0,3);

    const tiles = nextDays.map(k => {
      const arr = byDay[k];
      let pick = arr[0];
      let bestDiff = 24;
      for(const obj of arr){
        const diff = Math.abs(obj.hour - 12);
        if(diff < bestDiff){ bestDiff = diff; pick = obj; }
      }
      const d = pick.item;
      const t = Math.round(d.main.temp);
      const desc = d.weather?.[0]?.description || '—';
      const icon = d.weather?.[0]?.icon || '01d';
      const unitSym = units === 'metric' ? '°C' : '°F';
      const dayName = new Date(k).toLocaleDateString(undefined, { weekday: 'short', month:'short', day:'numeric' });
      return `
        <div class="tile">
          <div class="day">${dayName}</div>
          <img alt="icon" src="https://openweathermap.org/img/wn/${icon}.png" />
          <div><strong>${t}${unitSym}</strong> — ${capitalize(desc)}</div>
        </div>
      `;
    }).join('');

    forecastEl.innerHTML = tiles || '<div class="sub">No forecast available.</div>';
  }

  function renderError(err){
    currentEl.innerHTML = `<div class="sub">Error: ${escapeHtml(err.message)}<br/>Tip: Check the city name and that your backend is running.</div>`;
    forecastEl.innerHTML = '';
  }

  function capitalize(str){
    return (str||'').split(' ').map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(' ');
  }
  function escapeHtml(s){
    return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }
</script>

</body>
</html>
